import"../chunks/Bg9kRutz.js";import{D as it,E as ct,F as Ot,y as qt,i as Ft,ah as Pt,aI as Qt,p as ht,aF as lt,g as e,f as bt,s as d,c as n,n as Rt,r,d as Yt,t as R,a as gt,b as jt}from"../chunks/DO-sNwcH.js";import{t as T,a as h,c as Vt}from"../chunks/lqkcHzyT.js";import{d as wt,y as zt,s as dt,t as Gt,Q as vt,P as Jt,a as Kt,R as Ut}from"../chunks/CA7SxNC3.js";import{a as y,s as f,o as Wt}from"../chunks/DV48Rr-k.js";import{s as H}from"../chunks/D9Bo4rd8.js";import{i as mt}from"../chunks/CXucsld2.js";import{N as Xt,e as Zt}from"../chunks/CiBDaKyo.js";import{b as te,r as ee,a as ae}from"../chunks/BJy7j8il.js";import{s as Y}from"../chunks/CuVvyuch.js";import{d as oe}from"../chunks/8rSoxpob.js";import{p as C}from"../chunks/Lb3gLO7M.js";import{N as se,a as ut}from"../chunks/CKQjl_Ij.js";import{g as L}from"../chunks/CL7HX6yz.js";import{T as ft}from"../chunks/Dzak4FRR.js";import{_ as re}from"../chunks/CmfSzmyj.js";import{T as ne}from"../chunks/ChOvELRV.js";import{a as A}from"../chunks/BjibBYUr.js";function ie(o){var c=Ot,l=qt;it(null),ct(null);try{return o()}finally{it(c),ct(l)}}function ce(o,c,l,s=l){o.addEventListener(c,()=>ie(l));const v=o.__on_r;v?o.__on_r=()=>{v(),s(!0)}:o.__on_r=()=>s(!0),te()}function le(o,c,l=c){ce(o,"change",s=>{var v=s?o.defaultChecked:o.checked;l(v)}),(Ft&&o.defaultChecked!==o.checked||Pt(c)==null)&&l(o.checked),Qt(()=>{var s=c();o.checked=!!s})}function _t(o){return wt(o).getHours()}function pt(o){return wt(o).getMinutes()}var de=(o,c,l)=>c(e(l)),ve=T('<div style="cursor: pointer;"><div><span><strong> </strong></span></div></div>'),me=(o,c)=>{c("timesheet")},ue=T('<div class="position-fixed bottom-0 start-0 w-100 bg-light border-top py-2 px-3 d-flex align-items-center justify-content-between"><div class="container gap-1"><div class="row"><div class="col col-md-auto"><strong class="me-2 text-nowrap">Active:</strong> <div class="w-100"></div> <strong class="me-2 text-nowrap">Started:</strong> <div class="w-100"></div> <strong class="me-2 text-nowrap">Duration:</strong></div> <div class="col col-md-auto"><span> </span> <div class="w-100"></div> <span> </span> <div class="w-100"></div> <span> </span></div></div></div> <div><button class="btn btn-outline-danger">Stop Task</button></div></div>'),fe=T("<p>Are you sure you want to switch to another item?</p>"),_e=T("<p>The current item has been active for less than a minute. Are you sure you want to switch to another item?</p>"),pe=T(`<!> <div id="taskContainer"><h1 class="mb-3">Track today's tasks</h1>  <div class="form-check form-switch mb-3"><input class="form-check-input" type="checkbox" id="homeOfficeToggle"> <label class="form-check-label" for="homeOfficeToggle">Homeoffice</label></div> <div class="row"></div> <button id="timesheetBtn" type="button" class="btn btn-outline-secondary mt-3">Switch to Timesheet</button></div> <!> <div id="modal-switch" class="modal fade" tabindex="-1" style="background: rgba(0, 0, 0, 0.5);"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Confirm Item Switch</h5></div> <div class="modal-body"><!></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-primary">Yes, Switch</button></div></div></div></div> <div id="modal-leave" class="modal fade" tabindex="-1" style="background: rgba(0, 0, 0, 0.5);"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Confirm Item Switch</h5></div> <div class="modal-body"><p>Are you sure you want to leave the site while the tracker is active? Leaving causes the tracking to stop.</p></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-primary">Yes, Leave</button></div></div></div></div> <!>`,1);function he(o,c){ht(c,!0);let l=Yt(()=>{let t=[],a=0;for(const i of Gt.rune)i.hidden||(t.push({id:a,name:i.name,color:i.color}),a++);return t}),s=y(null),v=y(null),u=y(0),b=null,j=y("");lt(()=>{console.log(e(s))});let S=null,g=null,kt=zt.getDay(new Date),x,I,M=y(void 0);lt(()=>{f(j,`${Math.floor(e(u)/3600).toString().padStart(2,"0")}:${Math.floor(e(u)/60%60).toString().padStart(2,"0")}:${(e(u)%60).toString().padStart(2,"0")}`)});const yt=se.Item("Home",()=>{G("home")});function Tt(t){var a;if(((a=e(s))==null?void 0:a.id)!==t.id){if(e(s))if(dt.rune.confirmAllTaskSwitches||e(u)<5){S=t,x.show();return}else B();V(t)}}async function V(t){f(s,C(t)),f(v,C(new Date)),f(u,0),b&&clearInterval(b),b=setInterval(()=>{f(u,C(Math.floor((new Date-e(v))/1e3)))},1e3),t.id===e(l).length-1&&(await jt(),document.getElementById("timesheetBtn").scrollIntoView({behavior:"smooth"}))}function St(){x.hide(),B(),V(S),S=null}function xt(){x.hide(),S=null}function z(){B(),f(s,null),f(v,null),f(u,0),clearInterval(b),b=null}function B(){const t=`${_t(e(v))}:${pt(e(v))}`,a=new Date,i=`${_t(a)}:${pt(a)}`;let _=vt.Office;A.rune.atHome&&(_=vt.Home),e(s).name;const m=ft.new(e(s).name,t,i,_,!1);try{ft.validate(m)}catch(p){e(M)("Task entry was not created!",p.message,"text-bg-danger");return}kt.timesheet.push(m),console.log(m),Jt.modified(),e(M)("Created task entry",e(s).name,"text-bg-success")}function G(t){if(g=t,e(s))I.show();else switch(g){case"back":ut.goBack();break;case"timesheet":L(`/app/year/${new Date().getMonth()}/${new Date().getDate()}/timesheet`);break;case"home":default:L("/app");break}}function It(){I.hide()}Wt(()=>{x=new bootstrap.Modal("#modal-switch",{}),I=new bootstrap.Modal("#modal-leave",{}),document.getElementById("modal-leave").addEventListener("hidden.bs.modal",i=>{if(g)switch(e(s)&&z(),g){case"back":ut.goBack();break;case"timesheet":L(`/app/year/${new Date().getMonth()}/${new Date().getDate()}/timesheet`);break;case"home":default:L("/app");break}}),[...document.querySelectorAll(".toast")].map(i=>new bootstrap.Toast(i,{animation:!0,autohide:!0,delay:2e3}))});var J=pe(),K=bt(J);Xt(K,{name:"Track",navItems:[yt]});var D=d(K,2),N=d(n(D),2),U=n(N);ee(U),Rt(2),r(N);var O=d(N,2);Zt(O,21,()=>e(l),t=>t.id,(t,a)=>{var i=ve();let _;i.__click=[de,Tt,a];var m=n(i),p=n(m),$=n(p),w=n($,!0);r($),r(p),r(m),r(i),R(Q=>{var k,E;_=Y(i,1,"col-12 mb-2 svelte-19s4utb",null,_,{active:((k=e(s))==null?void 0:k.id)===e(a).id}),Y(m,1,`card p-3 ${(((E=e(s))==null?void 0:E.id)===e(a).id?"border-primary shadow active-item border-4":"border-2 ")??""}`,"svelte-19s4utb"),ae(m,"style",`color: ${Q??""}; background-color: ${e(a).color??""};`),H(w,e(a).name)},[()=>re(e(a).color)]),h(t,i)}),r(O);var Mt=d(O,2);Mt.__click=[me,G],r(D);var W=d(D,2);{var Dt=t=>{var a=ue(),i=n(a),_=n(i),m=d(n(_),2),p=n(m),$=n(p,!0);r(p);var w=d(p,4),Q=n(w,!0);r(w);var k=d(w,4),E=n(k,!0);r(k),r(m),r(_),r(i);var nt=d(i,2),Bt=n(nt);Bt.__click=z,r(nt),r(a),R(Nt=>{H($,e(s).name),H(Q,Nt),H(E,e(j))},[()=>e(v).toLocaleTimeString()]),h(t,a)};mt(W,t=>{e(s)&&t(Dt)})}var q=d(W,2),X=n(q),Z=n(X),F=d(n(Z),2),$t=n(F);{var Et=t=>{var a=fe();h(t,a)},Ht=t=>{var a=_e();h(t,a)};mt($t,t=>{dt.rune.confirmAllTaskSwitches?t(Et):t(Ht,!1)})}r(F);var tt=d(F,2),et=n(tt);et.__click=xt;var Ct=d(et,2);Ct.__click=St,r(tt),r(Z),r(X),r(q);var P=d(q,2),at=n(P),ot=n(at),st=d(n(ot),4),rt=n(st);rt.__click=()=>{g=null,I.hide()};var Lt=d(rt,2);Lt.__click=It,r(st),r(ot),r(at),r(P);var At=d(P,2);ne(At,{get show(){return e(M)},set show(t){f(M,C(t))}}),R(()=>Y(D,1,`container mt-3 mb-3 ${(e(s)?"navbar-aware":"")??""}`,"svelte-19s4utb")),le(U,()=>A.rune.atHome,t=>A.rune.atHome=t),h(o,J),gt()}oe(["click"]);function Ne(o,c){ht(c,!0);var l=Vt(),s=bt(l);Kt(s,()=>A.isLoaded(),null,(v,u)=>{he(v,{})},(v,u)=>{Ut(v,{})}),h(o,l),gt()}export{Ne as component};
