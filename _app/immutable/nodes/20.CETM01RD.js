import"../chunks/Bg9kRutz.js";import{t as x,p as je,c as i,s as h,j as se,r as a,k as v,a as Le,f as P}from"../chunks/Dk-3uZ7-.js";import{n as le,a as d,t as F,f as Ye,c as oe}from"../chunks/MEy6nb--.js";import{t as Ge,P as B,S as ie,v as We,w as Se,Y as Je,D as Ke,x as Qe,s as Ue,y as Xe,h as Ze,c as xe,g as Fe,i as Te,f as et}from"../chunks/BcqV0jEZ.js";import{R as tt}from"../chunks/CSLQCRWn.js";import{a as Ce}from"../chunks/Bb6kHuvm.js";import{a as N,s as j}from"../chunks/C2_p6BS0.js";import{s as I}from"../chunks/HYwG6HKy.js";import{p as D,i as z}from"../chunks/ClpcCWp1.js";import{d as at}from"../chunks/Cid6_tu6.js";import{s as V}from"../chunks/IvFCNWTJ.js";import{p as A}from"../chunks/BaFDXL54.js";import{g as rt}from"../chunks/Dex6RJ0O.js";import{T as O}from"../chunks/B46hv7NI.js";import{s as M}from"../chunks/70hiQGY9.js";import{l as st,L as it}from"../chunks/01nROYnL.js";function ke(f){return Ge(f).getFullYear()}var ot=le('<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-file-earmark-arrow-up" viewBox="0 0 16 16"><path d="M8.5 11.5a.5.5 0 0 1-1 0V7.707L6.354 8.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 7.707z"></path><path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"></path></svg>');function lt(f,e){let r=D(e,"size",3,16);D(e,"colorStyle",3,"");var o=ot();x(()=>{M(o,"width",r()),M(o,"height",r())}),d(f,o)}var nt=le('<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-file-earmark-arrow-up" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708z"></path><path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383m.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"></path></svg>');function ct(f,e){let r=D(e,"size",3,16);D(e,"colorStyle",3,"");var o=nt();x(()=>{M(o,"width",r()),M(o,"height",r())}),d(f,o)}var dt=le('<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-file-earmark-arrow-up" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"></path><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"></path></svg>');function ut(f,e){let r=D(e,"size",3,16);D(e,"colorStyle",3,"");var o=dt();x(()=>{M(o,"width",r()),M(o,"height",r())}),d(f,o)}class H{constructor(e){this.schema=e}validateSealed(e){return this.validate(e,this.schema,"",!0)}validate(e,r=this.schema,o="",w=!1){const n=[];for(const _ in r){const m=o?`${o}.${_}`:_,t=r[_],u=e[_];if(t.required&&u===void 0){n.push(`${m} is required.`);continue}if(u!==void 0){if(t.type)if(Array.isArray(t.type))t.type.includes(typeof u)||n.push(`${m} must be one of types: ${t.type.join(", ")}`);else if(t.type==="array"&&Array.isArray(u))t.length&&u.length!==t.length&&n.push(`${m} must have exactly ${t.length} items.`),t.itemType&&u.forEach((g,E)=>{if(typeof t.itemType=="object"){const R=new H(t.itemType);n.push(...R.validate(g,t.itemType,`${m}[${E}]`,(t==null?void 0:t.sealed)??!1))}else typeof g!==t.itemType&&n.push(`${m}[${E}] must be of type ${t.itemType}.`)});else if(t.type==="object"&&typeof u=="object"){if(t.schema){const g=new H(t.schema);n.push(...g.validate(u,t.schema,m,(t==null?void 0:t.sealed)??!1))}}else typeof u!==t.type&&n.push(`${m} must be of type ${t.type}`);if(t.validator&&typeof t.validator=="function"){const g=t.validator(u);g&&n.push(`${m}: ${g}`)}}}if(w){const _=new Set(Object.keys(r)),t=new Set(Object.keys(e)).difference(_);for(const u of t){const g=o?`${o}.${u}`:u;n.push(`${g}: Forbidden property definition.`)}}return n}}class $e{static isEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?null:"Invalid email format."}static isPhoneNumber(e){return/^\+?[0-9]{7,15}$/.test(e)?null:"Invalid phone number format."}static isPositiveNumber(e){return typeof e=="number"&&e>0?null:"Must be a positive number."}static matchesRegex(e){return r=>e.test(r)?null:"Does not match required pattern."}static equals(e){return r=>e===r?null:"Does not match required value."}static isTime(e){return/^(([0-1]\d)|(2[0-3])):[0-5]\d$/.test(e)?null:"Invalid time format."}static notNull(e){return e!==null}}const pt={type:"array",required:!0,itemType:{value:{type:"string",required:!0},bgColor:{type:"string",required:!0}}},vt={type:"array",required:!0,itemType:{name:{type:"string",required:!0},hidden:{type:"boolean",required:!0},isDefault:{type:"boolean",required:!0},color:{type:"string",required:!0}}},mt={application:{type:"object",required:!0,schema:{createdWith:{type:"string",required:!0}}},interaction:{type:"object",required:!0,schema:{confirmAllTaskSwitches:{type:"boolean",required:!0}}},style:{type:"object",required:!0,schema:{showTagsOnDays:{type:"boolean",required:!0},useMonthGridView:{type:"boolean",required:!0}}},contract:{type:"object",required:!0,schema:{homeOfficeQuota:{type:"number",required:!0},workingHours:{type:"number",required:!0},quotaCorrection:{type:"object",required:!0,schema:{quotaDate:{type:["string","object"],required:!0},quota:{type:"number",required:!0},workingHours:{type:"number",required:!0}}},showQuotaOnMonths:{type:"boolean",required:!0}}},capabilities:{type:"array",required:!0,itemType:"string"}},ft={date:{type:"string",required:!0},dayType:{type:"string",required:!0},dayState:{type:"number",required:!0},timesheet:{type:"array",required:!0,itemType:{taskName:{type:"string",required:!0},start:{type:"string",required:!0,validator:$e.isTime},end:{type:"string",required:!0,validator:$e.isTime},quotaType:{type:"string",required:!0}}},tags:{type:"array",itemType:"string",required:!0},additionalName:{type:"string",required:!0}},gt={yearLiteral:{type:"number",required:!0},days:{type:"array",itemType:ft,required:!0,sealed:!0}},yt={settings:{type:"object",required:!0,sealed:!0,schema:mt},tags:pt,tasks:vt,year:{type:"object",required:!0,schema:gt}};async function ht(f,e,r,o,w){j(e,A([]));const n=localStorage.getItem(B.localStorageSaveKey);if(n){const[_,m,t]=r(n);j(e,A(v(e).concat(m))),_?o(t):j(w,!0)}}var bt=F('<li class="list-group-item list-group-item-warning"> </li>'),wt=F('<li class="list-group-item list-group-item-danger"> </li>'),_t=F('<ul class="list-group mb-3"></ul>'),qt=F('<li class="list-group-item list-group-item-warning"> </li>'),St=F('<li class="list-group-item list-group-item-danger"> </li>'),xt=F('<ul class="list-group mb-3"></ul>'),Ft=F("<p>Successfully found a timesheet.</p>"),Tt=F('<!> <button type="button" class="btn btn-outline-secondary flex-fill" style="width: 7rem;">Import</button>',1),kt=F(`<div class="container my-5"><div class="row p-4 pb-0 pt-lg-5 rounded-3 border shadow-lg"><div class="col pb-0 ps-lg-5 pe-lg-5 pt-lg-3"><h1 class="display-4 fw-bold lh-1 text-body-emphasis mb-5">Let's get you started</h1> <div class="accordion" id="accordionExample"><div class="accordion-item"><h2 class="accordion-header"><button type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"><div class="d-flex align-items-center"><!> <div class="ms-4"><span class="lead h6">Import timesheet from save file</span></div></div></button></h2> <div id="collapseOne" data-bs-parent="#accordionExample"><div class="accordion-body"><p>Select the JSON file storing the timesheet. The file must be initially obtained by creating a new timesheet and saving it after any modification.</p> <div class="mt-3 mb-3" style="max-width: 30rem;"><input class="form-control" type="file" id="formFile" accept="application/json"></div> <!> <button type="button" class="btn btn-outline-secondary flex-fill" style="width: 7rem;">Import</button></div></div></div> <div class="accordion-item"><h2 class="accordion-header"><button type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo"><div class="d-flex align-items-center"><!> <div class="ms-4"><span class="lead h6">Import timesheet from browser storage</span></div></div></button></h2> <div id="collapseTwo" data-bs-parent="#accordionExample"><div class="accordion-body"><!></div></div></div> <div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed lead display-6" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree"><div class="d-flex align-items-center"><!> <div class="ms-4"><span class="lead h6">Create new timesheet</span></div></div></button></h2> <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionExample"><div class="accordion-body"><p>A new timesheet is created and loaded into the browser storage.</p> <button type="button" class="btn btn-outline-secondary flex-fill" style="width: 7rem;">New</button> <!></div></div></div></div> <div class="mt-4 mb-3 text-body-secondary d-flex justify-content-center"> </div></div></div></div>`);function $t(f,e){je(e,!0);const r=localStorage.getItem(B.localStorageSaveKey)!==null;let o=N(A([])),w=N(A([])),n=N(!0),_=N(!1),m=null;function t(){const s=new Date,l=Se.new();l.settings=We.new(),l.year=Je.new(ke(s));const c=Ke.getAllDaysOfYear(ke(s));for(const y of c)l.year.days.push(Qe.empty(y));l.tasks=[O.new("Pause",!1,!0,"#FFFFFF"),O.new("TaskA",!1,!1,"#FFFFFF"),O.new("TaskB",!1,!1,"#FFFFFF"),O.new("TaskC",!1,!1,"#FFFFFF")],g(l)}async function u(){g(m)}async function g(s){var l;s.tasks.length==0&&(s.tasks=[O.new("Pause",!1,!0,"#FFFFFF")]),Ue.rune=s.settings,Xe.rune=s.year,Ze.rune=s.tasks,xe.rune=s.tags,xe.regenerateLookup(),B.saveToLocalStorage(),Ce.rune.loaded=!0,"logger"in(((l=s==null?void 0:s.settings)==null?void 0:l.capabilities)??[])&&st.setLogLevel(it.LOG),rt("/app")}async function E(){j(o,A([])),j(n,!0);const s={error:"error"},l=document.getElementById("formFile");if(l.files.length==0)return;const c=l.files[0];if(!c.name.toLowerCase().endsWith(".json")){v(o).push({level:s.error,msg:"Invalid file selection."});return}const y=await c.text(),[k,q,p]=R(y);j(o,A(v(o).concat(q))),k&&(m=p,j(n,!1))}function R(s){const l={warn:"warn",error:"error"},c=[];let y=null;try{y=JSON.parse(s)}catch(b){return c.push({level:l.error,msg:`JSON parse error. ${b.message}`}),console.log(b),[!1,c,null]}const q=new H(yt).validateSealed(y);if(console.log(q),q.length>0)return c.push({level:l.error,msg:`Data model does not fulfill required schema. Found ${q.length} errors while parsing. Only reporting first: ${q[0]}`}),[!1,c,null];let p=null;try{p=Se.import(y)}catch(b){return c.push({level:l.error,msg:"Fatal error converting used data model."}),console.log(b),[!1,c,null]}return p.settings.application.createdWith!=ie.constants.version&&c.push({level:l.warn,msg:`Save version ${p.settings.application.createdWith} does not match system version ${ie.constants.version}.`}),[!0,c,p]}var Y=kt(),ne=i(Y),ce=i(ne),G=h(i(ce),2),W=i(G),J=i(W),K=i(J);V(K,1,`accordion-button ${(r?"collapsed":"")??""}`);var de=i(K),ze=i(de);lt(ze,{size:"20"}),se(2),a(de),a(K),a(J);var Q=h(J,2);V(Q,1,`accordion-collapse collapse ${(r?"":"show")??""}`);var ue=i(Q),U=h(i(ue),2),Ae=i(U);Ae.__change=E,a(U);var pe=h(U,2);{var De=s=>{var l=_t();Fe(l,21,()=>v(o),Te,(c,y)=>{var k=oe(),q=P(k);{var p=T=>{var S=bt(),L=i(S,!0);a(S),x(()=>I(L,v(y).msg)),d(T,S)},b=T=>{var S=wt(),L=i(S,!0);a(S),x(()=>I(L,v(y).msg)),d(T,S)};z(q,T=>{v(y).level=="warn"?T(p):T(b,!1)})}d(c,k)}),a(l),d(s,l)};z(pe,s=>{v(o).length>0&&s(De)})}var ve=h(pe,2);ve.__click=u,a(ue),a(Q),a(W);var X=h(W,2),Z=i(X),ee=i(Z);V(ee,1,`accordion-button ${(r?"":"collapsed")??""} lead display-4`);var me=i(ee),Me=i(me);ct(Me,{size:"20"}),se(2),a(me),a(ee),a(Z);var te=h(Z,2);V(te,1,`accordion-collapse collapse ${(r?"show":"")??""}`);var fe=i(te),Ie=i(fe);{var Oe=s=>{var l=Tt(),c=P(l);{var y=p=>{var b=xt();Fe(b,21,()=>v(w),Te,(T,S)=>{var L=oe(),Pe=P(L);{var Be=C=>{var $=qt(),re=i($,!0);a($),x(()=>I(re,v(S).msg)),d(C,$)},He=C=>{var $=St(),re=i($,!0);a($),x(()=>I(re,v(S).msg)),d(C,$)};z(Pe,C=>{v(S).level=="warn"?C(Be):C(He,!1)})}d(T,L)}),a(b),d(p,b)},k=p=>{var b=Ft();d(p,b)};z(c,p=>{v(w).length>0?p(y):p(k,!1)})}var q=h(c,2);q.__click=[ht,w,R,g,_],x(()=>q.disabled=v(_)?"true":""),d(s,l)},Ee=s=>{var l=Ye("There is no timesheet stored in the browser. You must either load a timesheet from a file or create a new one.");d(s,l)};z(Ie,s=>{localStorage.getItem(B.localStorageSaveKey)?s(Oe):s(Ee,!1)})}a(fe),a(te),a(X);var ge=h(X,2),ae=i(ge),ye=i(ae),he=i(ye),Re=i(he);ut(Re,{size:"20"}),se(2),a(he),a(ye),a(ae);var be=h(ae,2),we=i(be),_e=h(i(we),2);_e.__click=t;var Ne=h(_e,2);z(Ne,s=>{}),a(we),a(be),a(ge),a(G);var qe=h(G,2),Ve=i(qe);a(qe),a(ce),a(ne),a(Y),x(()=>{ve.disabled=v(n)?"true":"",I(Ve,`v${ie.constants.version}`)}),d(f,Y),Le()}at(["change","click"]);function Yt(f,e){je(e,!0);var r=oe(),o=P(r);et(o,()=>Ce.isGo(),null,(w,n)=>{$t(w,{})},(w,n)=>{tt(w,{})}),d(f,r),Le()}export{Yt as component};
