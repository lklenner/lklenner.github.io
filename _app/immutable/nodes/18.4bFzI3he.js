import"../chunks/Bg9kRutz.js";import{t as x,p as $e,c as i,s as h,j as ae,r as t,k as p,a as Le,f as N}from"../chunks/DVl1eqIf.js";import{n as oe,a as d,t as S,f as Ye,c as ie}from"../chunks/BbopcKfd.js";import{t as Ge,P as V,S as se,w as We,x as xe,Y as Je,D as Ke,z as Qe,s as Ue,y as Xe,h as Ze,c as Se,g as Fe,i as Te,f as et}from"../chunks/D2fgoS12.js";import{R as tt}from"../chunks/8YjbwXdl.js";import{a as ze}from"../chunks/DX14NvuP.js";import{a as O,s as I}from"../chunks/C_sUaDGO.js";import{s as A}from"../chunks/UmDqWYja.js";import{p as C,i as z}from"../chunks/CPODWPa_.js";import{d as rt}from"../chunks/3pJTpWBv.js";import{s as E}from"../chunks/9FSUsWcs.js";import{p as R}from"../chunks/9TXrOhxM.js";import{g as at}from"../chunks/C_VOrKsd.js";import{T as D}from"../chunks/B46hv7NI.js";import{s as M}from"../chunks/BtJF9F5H.js";import{l as st,L as it}from"../chunks/01nROYnL.js";function ke(m){return Ge(m).getFullYear()}var ot=oe('<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-file-earmark-arrow-up" viewBox="0 0 16 16"><path d="M8.5 11.5a.5.5 0 0 1-1 0V7.707L6.354 8.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 7.707z"></path><path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"></path></svg>');function lt(m,e){let r=C(e,"size",3,16);C(e,"colorStyle",3,"");var l=ot();x(()=>{M(l,"width",r()),M(l,"height",r())}),d(m,l)}var nt=oe('<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-file-earmark-arrow-up" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708z"></path><path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383m.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"></path></svg>');function ct(m,e){let r=C(e,"size",3,16);C(e,"colorStyle",3,"");var l=nt();x(()=>{M(l,"width",r()),M(l,"height",r())}),d(m,l)}var dt=oe('<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-file-earmark-arrow-up" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"></path><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"></path></svg>');function ut(m,e){let r=C(e,"size",3,16);C(e,"colorStyle",3,"");var l=dt();x(()=>{M(l,"width",r()),M(l,"height",r())}),d(m,l)}class P{constructor(e){this.schema=e}validate(e,r=this.schema,l=""){const n=[];for(const g in r){const f=l?`${l}.${g}`:g,a=r[g],v=e[g];if(a.required&&v===void 0){n.push(`${f} is required.`);continue}if(v!==void 0){if(a.type)if(Array.isArray(a.type))a.type.includes(typeof v)||n.push(`${f} must be one of types: ${a.type.join(", ")}`);else if(a.type==="array"&&Array.isArray(v))a.length&&v.length!==a.length&&n.push(`${f} must have exactly ${a.length} items.`),a.itemType&&v.forEach((q,j)=>{if(typeof a.itemType=="object"){const B=new P(a.itemType);n.push(...B.validate(q,a.itemType,`${f}[${j}]`))}else typeof q!==a.itemType&&n.push(`${f}[${j}] must be of type ${a.itemType}`)});else if(a.type==="object"&&typeof v=="object"){if(a.schema){const q=new P(a.schema);n.push(...q.validate(v,a.schema,f))}}else typeof v!==a.type&&n.push(`${f} must be of type ${a.type}`);if(a.validator&&typeof a.validator=="function"){const q=a.validator(v);q&&n.push(`${f}: ${q}`)}}}return n}}class je{static isEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?null:"Invalid email format."}static isPhoneNumber(e){return/^\+?[0-9]{7,15}$/.test(e)?null:"Invalid phone number format."}static isPositiveNumber(e){return typeof e=="number"&&e>0?null:"Must be a positive number."}static matchesRegex(e){return r=>e.test(r)?null:"Does not match required pattern."}static equals(e){return r=>e===r?null:"Does not match required value."}static isTime(e){return/^(([0-1]\d)|(2[0-3])):[0-5]\d$/.test(e)?null:"Invalid time format."}static notNull(e){return e!==null}}const pt={type:"array",required:!0,itemType:{value:{type:"string",required:!0},bgColor:{type:"string",required:!0}}},vt={type:"array",required:!0,itemType:{name:{type:"string",required:!0},hidden:{type:"boolean",required:!0},isDefault:{type:"boolean",required:!0},color:{type:"string",required:!0}}},mt={application:{type:"object",required:!0,schema:{createdWith:{type:"string",required:!0}}},interaction:{type:"object",required:!0,schema:{confirmAllTaskSwitches:{type:"boolean",required:!0}}},style:{type:"object",required:!0,schema:{showTagsOnDays:{type:"boolean",required:!0},useMonthGridView:{type:"boolean",required:!0}}},contract:{type:"object",required:!0,schema:{homeOfficeQuota:{type:"number",required:!0},workingHours:{type:"number",required:!0},quotaCorrection:{type:"object",required:!0,schema:{quotaDate:{type:["string","object"],required:!0},quota:{type:"number",required:!0},workingHours:{type:"number",required:!0}}},showQuotaOnMonths:{type:"boolean",required:!0}}},capabilitiies:{type:"array",required:!0}},gt={date:{type:"string",required:!0},dayType:{type:"string",required:!0},dayState:{type:"number",required:!0},quotaType:{type:"string",required:!0},timeState:{type:"string",required:!0},timesheet:{type:"array",required:!0,itemType:{taskName:{type:"string",required:!0},start:{type:"string",required:!0,validator:je.isTime},end:{type:"string",required:!0,validator:je.isTime},quotaType:{type:"string",required:!0}}},tags:{type:"array",itemType:"string",required:!0},additionalName:{type:"string",required:!0}},ft={yearLiteral:{type:"number",required:!0},days:{type:"array",itemType:gt,required:!0}},yt={settings:{type:"object",required:!0,schema:mt},tags:{type:"object",required:!0,schema:pt},tasks:{type:"object",required:!0,schema:vt},year:{type:"object",required:!0,schema:ft}};async function ht(m,e,r,l,n){const g=localStorage.getItem(V.localStorageSaveKey);if(g){const[f,a,v]=e(g);I(r,R(p(r).concat(a))),f?l(v):I(n,!0)}}var bt=S('<li class="list-group-item list-group-item-warning"> </li>'),wt=S('<li class="list-group-item list-group-item-danger"> </li>'),_t=S('<ul class="list-group mb-3"></ul>'),qt=S('<li class="list-group-item list-group-item-warning"> </li>'),xt=S('<li class="list-group-item list-group-item-danger"> </li>'),St=S('<ul class="list-group mb-3"></ul>'),Ft=S("<p>Successfully found a timesheet.</p>"),Tt=S('<!> <button type="button" class="btn btn-outline-secondary flex-fill" style="width: 7rem;">Import</button>',1),kt=S(`<div class="container my-5"><div class="row p-4 pb-0 pt-lg-5 rounded-3 border shadow-lg"><div class="col pb-0 ps-lg-5 pe-lg-5 pt-lg-3"><h1 class="display-4 fw-bold lh-1 text-body-emphasis mb-5">Let's get you started</h1> <div class="accordion" id="accordionExample"><div class="accordion-item"><h2 class="accordion-header"><button type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"><div class="d-flex align-items-center"><!> <div class="ms-4"><span class="lead h6">Import timesheet from save file</span></div></div></button></h2> <div id="collapseOne" data-bs-parent="#accordionExample"><div class="accordion-body"><p>Select the JSON file storing the timesheet. The file must be initially obtained by creating a new timesheet and saving it after any modification.</p> <div class="mt-3 mb-3" style="max-width: 30rem;"><input class="form-control" type="file" id="formFile" accept="application/json"></div> <!> <button type="button" class="btn btn-outline-secondary flex-fill" style="width: 7rem;">Import</button></div></div></div> <div class="accordion-item"><h2 class="accordion-header"><button type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo"><div class="d-flex align-items-center"><!> <div class="ms-4"><span class="lead h6">Import timesheet from browser storage</span></div></div></button></h2> <div id="collapseTwo" data-bs-parent="#accordionExample"><div class="accordion-body"><!></div></div></div> <div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed lead display-6" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree"><div class="d-flex align-items-center"><!> <div class="ms-4"><span class="lead h6">Create new timesheet</span></div></div></button></h2> <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionExample"><div class="accordion-body"><p>A new timesheet is created and loaded into the browser storage.</p> <button type="button" class="btn btn-outline-secondary flex-fill" style="width: 7rem;">New</button> <!></div></div></div></div> <div class="mt-4 mb-3 text-body-secondary d-flex justify-content-center"> </div></div></div></div>`);function jt(m,e){$e(e,!0);const r=localStorage.getItem(V.localStorageSaveKey)!==null;let l=O(R([])),n=O(R([])),g=O(!0),f=O(!1),a=null;function v(){const s=new Date,o=xe.new();o.settings=We.new(),o.year=Je.new(ke(s));const c=Ke.getAllDaysOfYear(ke(s));for(const y of c)o.year.days.push(Qe.empty(y));o.tasks=[D.new("Pause",!1,!0,"#FFFFFF"),D.new("TaskA",!1,!1,"#FFFFFF"),D.new("TaskB",!1,!1,"#FFFFFF"),D.new("TaskC",!1,!1,"#FFFFFF")],j(o)}async function q(){j(a)}async function j(s){var o;s.tasks.length==0&&(s.tasks=[D.new("Pause",!1,!0,"#FFFFFF")]),Ue.rune=s.settings,Xe.rune=s.year,Ze.rune=s.tasks,Se.rune=s.tags,Se.regenerateLookup(),V.saveToLocalStorage(),ze.rune.loaded=!0,"logger"in(((o=s==null?void 0:s.settings)==null?void 0:o.capabilitiies)??[])&&st.setLogLevel(it.LOG),at("/app")}async function B(){I(g,!0);const s={error:"error"},o=document.getElementById("formFile");if(o.files.length==0)return;const c=o.files[0];if(!c.name.toLowerCase().endsWith(".json")){p(l).push({level:s.error,msg:"Invalid file selection."});return}const y=await c.text(),[T,b,u]=le(y);I(l,R(p(l).concat(b))),T&&(a=u,I(g,!1))}function le(s){const o={warn:"warn",error:"error"},c=[];let y=null;try{y=JSON.parse(s)}catch(w){return c.push({level:o.error,msg:"JSON parse error."}),console.log(w),[!1,c,null]}const b=new P(yt).validate(y);if(console.log(b),b.length>0)return c.push({level:o.error,msg:`Data model does not fulfill required schema. Found ${b.length} errors while parsing. Only reporting first: ${b[0]}`}),[!1,c,null];let u=null;try{u=xe.import(y)}catch(w){return c.push({level:o.error,msg:"Fatal error converting used data model."}),console.log(w),[!1,c,null]}return u.settings.application.createdWith!=se.constants.version&&c.push({level:o.warn,msg:`Save version ${u.settings.application.createdWith} does not match system version ${se.constants.version}.`}),[!0,c,u]}var H=kt(),ne=i(H),ce=i(ne),Y=h(i(ce),2),G=i(Y),W=i(G),J=i(W);E(J,1,`accordion-button ${(r?"collapsed":"")??""}`);var de=i(J),Ce=i(de);lt(Ce,{size:"20"}),ae(2),t(de),t(J),t(W);var K=h(W,2);E(K,1,`accordion-collapse collapse ${(r?"":"show")??""}`);var ue=i(K),Q=h(i(ue),2),Me=i(Q);Me.__change=B,t(Q);var pe=h(Q,2);{var Ae=s=>{var o=_t();Fe(o,21,()=>p(l),Te,(c,y)=>{var T=ie(),b=N(T);{var u=F=>{var _=bt(),$=i(_,!0);t(_),x(()=>A($,p(y).msg)),d(F,_)},w=F=>{var _=wt(),$=i(_,!0);t(_),x(()=>A($,p(y).msg)),d(F,_)};z(b,F=>{p(y).level=="warn"?F(u):F(w,!1)})}d(c,T)}),t(o),d(s,o)};z(pe,s=>{p(l).length>0&&s(Ae)})}var ve=h(pe,2);ve.__click=q,t(ue),t(K),t(G);var U=h(G,2),X=i(U),Z=i(X);E(Z,1,`accordion-button ${(r?"":"collapsed")??""} lead display-4`);var me=i(Z),De=i(me);ct(De,{size:"20"}),ae(2),t(me),t(Z),t(X);var ee=h(X,2);E(ee,1,`accordion-collapse collapse ${(r?"show":"")??""}`);var ge=i(ee),Ie=i(ge);{var Oe=s=>{var o=Tt(),c=N(o);{var y=u=>{var w=St();Fe(w,21,()=>p(n),Te,(F,_)=>{var $=ie(),Pe=N($);{var Be=L=>{var k=qt(),re=i(k,!0);t(k),x(()=>A(re,p(_).msg)),d(L,k)},He=L=>{var k=xt(),re=i(k,!0);t(k),x(()=>A(re,p(_).msg)),d(L,k)};z(Pe,L=>{p(_).level=="warn"?L(Be):L(He,!1)})}d(F,$)}),t(w),d(u,w)},T=u=>{var w=Ft();d(u,w)};z(c,u=>{p(n).length>0?u(y):u(T,!1)})}var b=h(c,2);b.__click=[ht,le,n,j,f],x(()=>b.disabled=p(f)?"true":""),d(s,o)},Ee=s=>{var o=Ye("There is no timesheet stored in the browser. You must either load a timesheet from a file or create a new one.");d(s,o)};z(Ie,s=>{localStorage.getItem(V.localStorageSaveKey)?s(Oe):s(Ee,!1)})}t(ge),t(ee),t(U);var fe=h(U,2),te=i(fe),ye=i(te),he=i(ye),Ne=i(he);ut(Ne,{size:"20"}),ae(2),t(he),t(ye),t(te);var be=h(te,2),we=i(be),_e=h(i(we),2);_e.__click=v;var Ve=h(_e,2);z(Ve,s=>{}),t(we),t(be),t(fe),t(Y);var qe=h(Y,2),Re=i(qe);t(qe),t(ce),t(ne),t(H),x(()=>{ve.disabled=p(g)?"true":"",A(Re,`v${se.constants.version}`)}),d(m,H),Le()}rt(["change","click"]);function Yt(m,e){$e(e,!0);var r=ie(),l=N(r);et(l,()=>ze.isGo(),null,(n,g)=>{jt(n,{})},(n,g)=>{tt(n,{})}),d(m,r),Le()}export{Yt as component};
