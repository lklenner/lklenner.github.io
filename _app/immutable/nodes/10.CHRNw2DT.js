import"../chunks/Bg9kRutz.js";import{h as Bt,a5 as Lt,az as Nt,p as ft,X as Ot,g as e,f as pt,s as l,c as r,n as jt,r as s,v as qt,t as R,a as ht,b as Pt}from"../chunks/BUjIT_Mk.js";import{t as y,a as h,c as Qt}from"../chunks/B9kf_Ie_.js";import{t as bt,y as Rt,e as Yt,s as it,c as zt,j as lt,Q as ct,P as Vt,b as Xt,R as Ft}from"../chunks/Dnvx4tmM.js";import{s as u,a as w,o as Gt}from"../chunks/CIwiONnU.js";import{s as H}from"../chunks/BjGBDkgq.js";import{i as dt}from"../chunks/18K141Sn.js";import{r as Jt,s as Kt}from"../chunks/LVKOVOzu.js";import{s as Y}from"../chunks/DDCU0q_E.js";import{l as Ut,d as Wt}from"../chunks/ChM4DITq.js";import{p as C}from"../chunks/BacJj1fc.js";import{N as Zt}from"../chunks/BXGJI-AL.js";import{N as te,a as vt}from"../chunks/C5m1Kr_D.js";import{g as A}from"../chunks/BwmWtf6n.js";import{_ as ee}from"../chunks/5rqLzJeP.js";import{T as ae}from"../chunks/CqTqg-3p.js";import{a as B}from"../chunks/DqWk7Urd.js";function oe(i,c,o=c){Ut(i,"change",v=>{var d=v?i.defaultChecked:i.checked;o(d)}),(Bt&&i.defaultChecked!==i.checked||Lt(c)==null)&&o(i.checked),Nt(()=>{var v=c();i.checked=!!v})}function mt(i){return bt(i).getHours()}function ut(i){return bt(i).getMinutes()}var se=(i,c,o)=>c(e(o)),re=y('<div style="cursor: pointer;"><div><span><strong> </strong></span></div></div>'),ne=(i,c)=>{c("timesheet")},ie=y('<div class="position-fixed bottom-0 start-0 w-100 bg-light border-top py-2 px-3 d-flex align-items-center justify-content-between"><div class="container gap-1"><div class="row"><div class="col col-md-auto"><strong class="me-2 text-nowrap">Active:</strong> <div class="w-100"></div> <strong class="me-2 text-nowrap">Started:</strong> <div class="w-100"></div> <strong class="me-2 text-nowrap">Duration:</strong></div> <div class="col col-md-auto"><span> </span> <div class="w-100"></div> <span> </span> <div class="w-100"></div> <span> </span></div></div></div> <div><button class="btn btn-outline-danger">Stop Task</button></div></div>'),le=y("<p>Are you sure you want to switch to another item?</p>"),ce=y("<p>The current item has been active for less than a minute. Are you sure you want to switch to another item?</p>"),de=y(`<!> <div id="taskContainer"><h1 class="mb-3">Track today's tasks</h1>  <div class="form-check form-switch mb-3"><input class="form-check-input" type="checkbox" id="homeOfficeToggle"> <label class="form-check-label" for="homeOfficeToggle">Homeoffice</label></div> <div class="row"></div> <button id="timesheetBtn" type="button" class="btn btn-outline-secondary mt-3">Switch to Timesheet</button></div> <!> <div id="modal-switch" class="modal fade" tabindex="-1" style="background: rgba(0, 0, 0, 0.5);"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Confirm Item Switch</h5></div> <div class="modal-body"><!></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-primary">Yes, Switch</button></div></div></div></div> <div id="modal-leave" class="modal fade" tabindex="-1" style="background: rgba(0, 0, 0, 0.5);"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Confirm Item Switch</h5></div> <div class="modal-body"><p>Are you sure you want to leave the site while the tracker is active? Leaving causes the tracking to stop.</p></div> <div class="modal-footer"><button type="button" class="btn btn-secondary">Cancel</button> <button type="button" class="btn btn-primary">Yes, Leave</button></div></div></div></div> <!>`,1);function ve(i,c){ft(c,!0);let o=w(null),v=w(null),d=w(0),T=w(""),S=w(void 0),_t=Rt.getDay(new Date),z=qt(()=>{let t=[],a=0;for(const n of zt.rune)n.hidden||(t.push({id:a,name:n.name,color:n.color}),a++);return t});Ot(()=>{u(T,`${Math.floor(e(d)/3600).toString().padStart(2,"0")}:${Math.floor(e(d)/60%60).toString().padStart(2,"0")}:${(e(d)%60).toString().padStart(2,"0")}`)});let b=null,x=null,_=null,M,D;const gt=te.Item("Home",()=>{F("home")});function kt(t){var a;if(((a=e(o))==null?void 0:a.id)!==t.id){if(e(o))if(it.rune.track.confirmAllTaskSwitches||e(d)<5){x=t,M.show();return}else L();V(t)}}async function V(t){u(o,C(t)),u(v,C(new Date)),u(d,0),b&&clearInterval(b),b=setInterval(()=>{u(d,C(Math.floor((new Date-e(v))/1e3)))},1e3),t.id===e(z).length-1&&(await Pt(),document.getElementById("timesheetBtn").scrollIntoView({behavior:"smooth"}))}function wt(){M.hide(),L(),V(x),x=null}function yt(){M.hide(),x=null}function X(){L(),u(o,null),u(v,null),u(d,0),clearInterval(b),b=null}function L(){const t=`${mt(e(v))}:${ut(e(v))}`,a=new Date,n=`${mt(a)}:${ut(a)}`;let f=ct.Office;B.rune.atHome&&(f=ct.Home),e(o).name;const m=lt.new(e(o).name,t,n,f,!1);try{lt.validate(m)}catch(p){e(S)("Task entry was not created!",p.message,"text-bg-danger");return}_t.timesheet.push(m),console.log(m),Vt.modified(),e(S)("Created task entry",e(o).name,"text-bg-success")}function F(t){if(_=t,e(o))D.show();else switch(_){case"back":vt.goBack();break;case"timesheet":A(`/app/year/${new Date().getMonth()}/${new Date().getDate()}/timesheet`);break;case"home":default:A("/app");break}}function Tt(){D.hide()}Gt(()=>{M=new bootstrap.Modal("#modal-switch",{}),D=new bootstrap.Modal("#modal-leave",{}),document.getElementById("modal-leave").addEventListener("hidden.bs.modal",n=>{if(_)switch(e(o)&&X(),_){case"back":vt.goBack();break;case"timesheet":A(`/app/year/${new Date().getMonth()}/${new Date().getDate()}/timesheet`);break;case"home":default:A("/app");break}}),[...document.querySelectorAll(".toast")].map(n=>new bootstrap.Toast(n,{animation:!0,autohide:!0,delay:2e3}))});var G=de(),J=pt(G);Zt(J,{name:"Track",navItems:[gt]});var I=l(J,2),N=l(r(I),2),K=r(N);Jt(K),jt(2),s(N);var O=l(N,2);Yt(O,21,()=>e(z),t=>t.id,(t,a)=>{var n=re();let f;n.__click=[se,kt,a];var m=r(n),p=r(m),$=r(p),g=r($,!0);s($),s(p),s(m),s(n),R(Q=>{var k,E;f=Y(n,1,"col-12 mb-2 svelte-19s4utb",null,f,{active:((k=e(o))==null?void 0:k.id)===e(a).id}),Y(m,1,`card p-3 ${(((E=e(o))==null?void 0:E.id)===e(a).id?"border-primary shadow active-item border-4":"border-2 ")??""}`,"svelte-19s4utb"),Kt(m,"style",`color: ${Q??""}; background-color: ${e(a).color??""};`),H(g,e(a).name)},[()=>ee(e(a).color)]),h(t,n)}),s(O);var St=l(O,2);St.__click=[ne,F],s(I);var U=l(I,2);{var xt=t=>{var a=ie(),n=r(a),f=r(n),m=l(r(f),2),p=r(m),$=r(p,!0);s(p);var g=l(p,4),Q=r(g,!0);s(g);var k=l(g,4),E=r(k,!0);s(k),s(m),s(f),s(n);var nt=l(n,2),Ct=r(nt);Ct.__click=X,s(nt),s(a),R(At=>{H($,e(o).name),H(Q,At),H(E,e(T))},[()=>e(v).toLocaleTimeString("de-DE")]),h(t,a)};dt(U,t=>{e(o)&&t(xt)})}var j=l(U,2),W=r(j),Z=r(W),q=l(r(Z),2),Mt=r(q);{var Dt=t=>{var a=le();h(t,a)},It=t=>{var a=ce();h(t,a)};dt(Mt,t=>{it.rune.track.confirmAllTaskSwitches?t(Dt):t(It,!1)})}s(q);var tt=l(q,2),et=r(tt);et.__click=yt;var $t=l(et,2);$t.__click=wt,s(tt),s(Z),s(W),s(j);var P=l(j,2),at=r(P),ot=r(at),st=l(r(ot),4),rt=r(st);rt.__click=()=>{_=null,D.hide()};var Et=l(rt,2);Et.__click=Tt,s(st),s(ot),s(at),s(P);var Ht=l(P,2);ae(Ht,{get show(){return e(S)},set show(t){u(S,C(t))}}),R(()=>Y(I,1,`container mt-3 mb-3 ${(e(o)?"navbar-aware":"")??""}`,"svelte-19s4utb")),oe(K,()=>B.rune.atHome,t=>B.rune.atHome=t),h(i,G),ht()}Wt(["click"]);function $e(i,c){ft(c,!0);var o=Qt(),v=pt(o);Xt(v,()=>B.isLoaded(),null,(d,T)=>{ve(d,{})},(d,T)=>{Ft(d,{})}),h(i,o),ht()}export{$e as component};
