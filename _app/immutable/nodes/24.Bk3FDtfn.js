import"../chunks/Bg9kRutz.js";import{t as F,p as Ie,c as i,s as y,v as oe,r as s,m,a as Me,f as P}from"../chunks/DCGbEjkp.js";import{n as de,a as d,t as w,e as Ue,c as ne}from"../chunks/B6we1ui4.js";import{t as Xe,P as N,S as ie,w as Ze,x as ce,Y as et,D as tt,z as at,h as R,q as rt,y as st,d as ot,f as je,c as Ce,i as Le,a as it}from"../chunks/Dtfp-KIX.js";import{R as lt}from"../chunks/EjqemIE5.js";import{a as Ae}from"../chunks/BVxO1hEQ.js";import{a as O,o as nt,c as ct,s as $}from"../chunks/Cc6sp6Aj.js";import{s as E}from"../chunks/DjLPlESz.js";import{p as D,i as k}from"../chunks/R7SZNG97.js";import{d as dt}from"../chunks/nxS3RBuk.js";import{s as V}from"../chunks/DctH-kaB.js";import{g as ut}from"../chunks/CxHFiZ8Q.js";import{s as I}from"../chunks/CQJXRoj6.js";import{p as M}from"../chunks/CZpImU8R.js";import{l as pt,L as vt}from"../chunks/01nROYnL.js";import{s as le}from"../chunks/uDKsQiKN.js";function ze(f){return Xe(f).getFullYear()}var mt=de('<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-file-earmark-arrow-up" viewBox="0 0 16 16"><path d="M8.5 11.5a.5.5 0 0 1-1 0V7.707L6.354 8.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 7.707z"></path><path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"></path></svg>');function ft(f,e){let a=M(e,"size",3,16);M(e,"colorStyle",3,"");var o=mt();F(()=>{I(o,"width",a()),I(o,"height",a())}),d(f,o)}var gt=de('<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-file-earmark-arrow-up" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708z"></path><path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383m.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"></path></svg>');function yt(f,e){let a=M(e,"size",3,16);M(e,"colorStyle",3,"");var o=gt();F(()=>{I(o,"width",a()),I(o,"height",a())}),d(f,o)}var ht=de('<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-file-earmark-arrow-up" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"></path><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"></path></svg>');function bt(f,e){let a=M(e,"size",3,16);M(e,"colorStyle",3,"");var o=ht();F(()=>{I(o,"width",a()),I(o,"height",a())}),d(f,o)}class B{constructor(e){this.schema=e}validateSealed(e){return this.validate(e,this.schema,"",!0)}validate(e,a=this.schema,o="",h=!1){const u=[];for(const _ in a){const g=o?`${o}.${_}`:_,t=a[_],v=e[_];if(t.required&&v===void 0){u.push(`${g} is required.`);continue}if(v!==void 0){if(t.type)if(Array.isArray(t.type))t.type.includes(typeof v)||u.push(`${g} must be one of types: ${t.type.join(", ")}`);else if(t.type==="array"&&Array.isArray(v))t.length&&v.length!==t.length&&u.push(`${g} must have exactly ${t.length} items.`),t.itemType&&v.forEach((S,j)=>{if(typeof t.itemType=="object"){const H=new B(t.itemType);u.push(...H.validate(S,t.itemType,`${g}[${j}]`,(t==null?void 0:t.sealed)??!1))}else typeof S!==t.itemType&&u.push(`${g}[${j}] must be of type ${t.itemType}.`)});else if(t.type==="object"&&typeof v=="object"){if(t.schema){const S=new B(t.schema);u.push(...S.validate(v,t.schema,g,(t==null?void 0:t.sealed)??!1))}}else typeof v!==t.type&&u.push(`${g} must be of type ${t.type}`);if(t.validator&&typeof t.validator=="function"){const S=t.validator(v);S&&u.push(`${g}: ${S}`)}}}if(h){const _=new Set(Object.keys(a)),t=new Set(Object.keys(e)).difference(_);for(const v of t){const S=o?`${o}.${v}`:v;u.push(`${S}: Forbidden property definition.`)}}return u}}class De{static isEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?null:"Invalid email format."}static isPhoneNumber(e){return/^\+?[0-9]{7,15}$/.test(e)?null:"Invalid phone number format."}static isPositiveNumber(e){return typeof e=="number"&&e>0?null:"Must be a positive number."}static matchesRegex(e){return a=>e.test(a)?null:"Does not match required pattern."}static equals(e){return a=>e===a?null:"Does not match required value."}static isTime(e){return/^(([0-1]\d)|(2[0-3])):[0-5]\d$/.test(e)?null:"Invalid time format."}static notNull(e){return e!==null}}const _t={type:"array",required:!0,itemType:{value:{type:"string",required:!0},bgColor:{type:"string",required:!0}}},wt={type:"array",required:!0,itemType:{name:{type:"string",required:!0},hidden:{type:"boolean",required:!0},isDefault:{type:"boolean",required:!0},color:{type:"string",required:!0}}},St={application:{type:"object",required:!0,schema:{createdWith:{type:"string",required:!0}}},interaction:{type:"object",required:!0,schema:{confirmAllTaskSwitches:{type:"boolean",required:!0}}},style:{type:"object",required:!0,schema:{showTagsOnDays:{type:"boolean",required:!0},useMonthGridView:{type:"boolean",required:!0}}},contract:{type:"object",required:!0,schema:{homeOfficeQuota:{type:"number",required:!0},workingHours:{type:"number",required:!0},quotaCorrection:{type:"object",required:!0,schema:{quotaDate:{type:["string","object"],required:!0},quota:{type:"number",required:!0},workingHours:{type:"number",required:!0}}},showQuotaOnMonths:{type:"boolean",required:!0}}},capabilities:{type:"array",required:!0,itemType:"string"}},qt={date:{type:"string",required:!0},dayType:{type:"string",required:!0},dayState:{type:"number",required:!0},timesheet:{type:"array",required:!0,itemType:{taskName:{type:"string",required:!0},start:{type:"string",required:!0,validator:De.isTime},end:{type:"string",required:!0,validator:De.isTime},quotaType:{type:"string",required:!0}}},tags:{type:"array",itemType:"string",required:!0},additionalName:{type:"string",required:!0}},xt={yearLiteral:{type:"number",required:!0},days:{type:"array",itemType:qt,required:!0,sealed:!0}},Ft={settings:{type:"object",required:!0,sealed:!0,schema:St},tags:_t,tasks:wt,year:{type:"object",required:!0,schema:xt}};async function Tt(f,e,a,o,h,u){$(e,D([]));const _=localStorage.getItem(N.localStorageSaveKey);if(_){const[g,t,v]=a(_);$(e,D(m(e).concat(t))),g?t.length==0?o(v):$(h,!0):$(u,!0)}}function kt(f,e){const a=localStorage.getItem(N.localStorageSaveKey),o=JSON.parse(a),h=ce.import(o);e(h)}var $t=w('<ul class="list-group mb-3"><li class="list-group-item list-group-item-danger">The website appears to already be open in another tab.</li></ul>'),jt=w('<li class="list-group-item list-group-item-warning"> </li>'),Ct=w('<li class="list-group-item list-group-item-danger"> </li>'),Lt=w('<ul class="list-group mb-3"></ul>'),zt=w('<li class="list-group-item list-group-item-warning"> </li>'),Dt=w('<li class="list-group-item list-group-item-danger"> </li>'),It=w('<ul class="list-group mb-3"></ul>'),Mt=w("<p>Successfully found a timesheet.</p>"),At=w('<button type="button" class="btn btn-outline-secondary flex-fill" style="width: 7rem;">Import</button>'),Ot=w('<button type="button" class="btn btn-outline-secondary flex-fill" style="width: 7rem;">Continue</button>'),Et=w("<!> <!>",1),Nt=w(`<div class="container my-5"><div class="row p-4 pb-0 pt-lg-5 rounded-3 border shadow-lg"><div class="col pb-0 ps-lg-5 pe-lg-5 pt-lg-3"><h1 class="display-4 fw-bold lh-1 text-body-emphasis mb-5">Let's get you started</h1> <!> <div class="accordion" id="accordionExample"><div class="accordion-item"><h2 class="accordion-header"><button type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"><div class="d-flex align-items-center"><!> <div class="ms-4"><span class="lead h6">Import timesheet from save file</span></div></div></button></h2> <div id="collapseOne" data-bs-parent="#accordionExample"><div class="accordion-body"><p>Select the JSON file storing the timesheet. The file must be initially obtained by creating a new timesheet and saving it after any modification.</p> <div class="mt-3 mb-3" style="max-width: 30rem;"><input class="form-control" type="file" id="formFile" accept="application/json"></div> <!> <button type="button" class="btn btn-outline-secondary flex-fill" style="width: 7rem;">Import</button></div></div></div> <div class="accordion-item"><h2 class="accordion-header"><button type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo"><div class="d-flex align-items-center"><!> <div class="ms-4"><span class="lead h6">Import timesheet from browser storage</span></div></div></button></h2> <div id="collapseTwo" data-bs-parent="#accordionExample"><div class="accordion-body"><!></div></div></div> <div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button collapsed lead display-6" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree"><div class="d-flex align-items-center"><!> <div class="ms-4"><span class="lead h6">Create new timesheet</span></div></div></button></h2> <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionExample"><div class="accordion-body"><p>A new timesheet is created and loaded into the browser storage.</p> <button type="button" class="btn btn-outline-secondary flex-fill" style="width: 7rem;">New</button> <!></div></div></div></div> <div class="mt-4 mb-3 text-body-secondary d-flex justify-content-center"> </div></div></div></div>`);function Rt(f,e){Ie(e,!0);const a=localStorage.getItem(N.localStorageSaveKey)!==null;let o=O(D([])),h=O(D([])),u=O(!0),_=O(!1),g=O(!1),t=null;function v(){const r=new Date,l=ce.new();l.settings=Ze.new(),l.year=et.new(ze(r));const p=tt.getAllDaysOfYear(ze(r));for(const b of p)l.year.days.push(at.empty(b));l.tasks=[R.new("Pause",!1,!0,"#FFFFFF"),R.new("TaskA",!1,!1,"#FFFFFF"),R.new("TaskB",!1,!1,"#FFFFFF"),R.new("TaskC",!1,!1,"#FFFFFF")],j(l)}async function S(){j(t)}async function j(r){var l;rt.rune=r.settings,st.rune=r.year,ot.rune=r.tasks,je.rune=r.tags,je.regenerateLookup(),N.saveToLocalStorage(),Ae.rune.loaded=!0,"logger"in(((l=r==null?void 0:r.settings)==null?void 0:l.capabilities)??[])&&pt.setLogLevel(vt.LOG),ut("/app")}async function H(){$(o,D([])),$(u,!0);const r={error:"error"},l=document.getElementById("formFile");if(l.files.length==0)return;const p=l.files[0];if(!p.name.toLowerCase().endsWith(".json")){m(o).push({level:r.error,msg:"Invalid file selection."});return}const b=await p.text(),[C,q,x]=ue(b);$(o,D(m(o).concat(q))),C&&(t=x,$(u,!1))}function ue(r){const l={warn:"warn",error:"error"},p=[];let b=null;try{b=JSON.parse(r)}catch(T){return p.push({level:l.error,msg:`JSON parse error. ${T.message}`}),console.log(T),[!1,p,null]}const q=new B(Ft).validateSealed(b);if(console.log(q),q.length>0)return p.push({level:l.error,msg:`Data model does not fulfill required schema. Found ${q.length} errors while parsing. Only reporting first: ${q[0]}`}),[!1,p,null];let x=null;try{x=ce.import(b)}catch(T){return p.push({level:l.error,msg:"Fatal error converting used data model."}),console.log(T),[!1,p,null]}return x.settings.application.createdWith!=ie.constants.version&&p.push({level:l.warn,msg:`Save version ${x.settings.application.createdWith} does not match system version ${ie.constants.version}.`}),[!0,p,x]}nt(()=>{le.preregister()}),ct(()=>{le.unpreregsiter()});var Y=Nt(),pe=i(Y),ve=i(pe),me=y(i(ve),2);{var Oe=r=>{var l=$t();d(r,l)};k(me,r=>{le.claimed&&r(Oe)})}var G=y(me,2),J=i(G),K=i(J),W=i(K);V(W,1,`accordion-button ${(a?"collapsed":"")??""}`);var fe=i(W),Ee=i(fe);ft(Ee,{size:"20"}),oe(2),s(fe),s(W),s(K);var Q=y(K,2);V(Q,1,`accordion-collapse collapse ${(a?"":"show")??""}`);var ge=i(Q),U=y(i(ge),2),Ne=i(U);Ne.__change=H,s(U);var ye=y(U,2);{var Re=r=>{var l=Lt();Ce(l,21,()=>m(o),Le,(p,b)=>{var C=ne(),q=P(C);{var x=n=>{var c=jt(),A=i(c,!0);s(c),F(()=>E(A,m(b).msg)),d(n,c)},T=n=>{var c=Ct(),A=i(c,!0);s(c),F(()=>E(A,m(b).msg)),d(n,c)};k(q,n=>{m(b).level=="warn"?n(x):n(T,!1)})}d(p,C)}),s(l),d(r,l)};k(ye,r=>{m(o).length>0&&r(Re)})}var he=y(ye,2);he.__click=S,s(ge),s(Q),s(J);var X=y(J,2),Z=i(X),ee=i(Z);V(ee,1,`accordion-button ${(a?"":"collapsed")??""} lead display-4`);var be=i(ee),Ve=i(be);yt(Ve,{size:"20"}),oe(2),s(be),s(ee),s(Z);var te=y(Z,2);V(te,1,`accordion-collapse collapse ${(a?"show":"")??""}`);var _e=i(te),Pe=i(_e);{var Be=r=>{var l=Et(),p=P(l);{var b=n=>{var c=It();Ce(c,21,()=>m(h),Le,(A,re)=>{var $e=ne(),Ke=P($e);{var We=z=>{var L=zt(),se=i(L,!0);s(L),F(()=>E(se,m(re).msg)),d(z,L)},Qe=z=>{var L=Dt(),se=i(L,!0);s(L),F(()=>E(se,m(re).msg)),d(z,L)};k(Ke,z=>{m(re).level=="warn"?z(We):z(Qe,!1)})}d(A,$e)}),s(c),d(n,c)},C=n=>{var c=Mt();d(n,c)};k(p,n=>{m(h).length>0?n(b):n(C,!1)})}var q=y(p,2);{var x=n=>{var c=At();c.__click=[Tt,h,ue,j,g,_],F(()=>c.disabled=m(_)?"true":""),d(n,c)},T=n=>{var c=Ot();c.__click=[kt,j],d(n,c)};k(q,n=>{m(g)?n(T,!1):n(x)})}d(r,l)},He=r=>{var l=Ue("There is no timesheet stored in the browser. You must either load a timesheet from a file or create a new one.");d(r,l)};k(Pe,r=>{localStorage.getItem(N.localStorageSaveKey)?r(Be):r(He,!1)})}s(_e),s(te),s(X);var we=y(X,2),ae=i(we),Se=i(ae),qe=i(Se),Ye=i(qe);bt(Ye,{size:"20"}),oe(2),s(qe),s(Se),s(ae);var xe=y(ae,2),Fe=i(xe),Te=y(i(Fe),2);Te.__click=v;var Ge=y(Te,2);k(Ge,r=>{}),s(Fe),s(xe),s(we),s(G);var ke=y(G,2),Je=i(ke);s(ke),s(ve),s(pe),s(Y),F(()=>{he.disabled=m(u)?"true":"",E(Je,`v${ie.constants.version}`)}),d(f,Y),Me()}dt(["change","click"]);function ra(f,e){Ie(e,!0);var a=ne(),o=P(a);it(o,()=>Ae.isGo(),null,(h,u)=>{Rt(h,{})},(h,u)=>{lt(h,{})}),d(f,a),Me()}export{ra as component};
